<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test File Upload</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-8">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">–¢–µ—Å—Ç File Upload –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</h1>

    <!-- File Upload Area -->
    <div class="bg-white p-6 rounded-lg shadow">
      <div id="upload-area"
        class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-gray-400 transition-colors">
        <input type="file" id="file-input" multiple accept=".pdf,.doc,.docx,.txt,.md,.rtf" class="hidden">

        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
          <path
            d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>

        <p class="text-sm text-gray-600">
          <span class="font-medium text-blue-600 hover:text-blue-500">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</span>
          –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏—Ö —Å—é–¥–∞
        </p>
        <p class="text-xs text-gray-500 mt-1">
          PDF, DOC, DOCX, TXT, MD, RTF –¥–æ 10MB –∫–∞–∂–¥—ã–π
        </p>
      </div>

      <!-- File List -->
      <div id="file-list" class="mt-6 space-y-3" style="display: none;">
        <h4 class="text-sm font-medium text-gray-900">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
        <div id="files-container"></div>
      </div>

      <!-- Validation Results -->
      <div id="validation-results" class="mt-4"></div>
    </div>
  </div>

  <script>
    // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è validation –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
    const ALLOWED_EXTENSIONS = ['.pdf', '.doc', '.docx', '.txt', '.md', '.rtf'];

    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const filesContainer = document.getElementById('files-container');
    const validationResults = document.getElementById('validation-results');

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
    function validateFile(file) {
      const errors = [];
      const warnings = [];
      const extension = '.' + file.name.split('.').pop().toLowerCase();

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
      if (file.size > MAX_FILE_SIZE) {
        errors.push(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º: ${formatFileSize(MAX_FILE_SIZE)}`);
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
      if (!ALLOWED_EXTENSIONS.includes(extension)) {
        errors.push(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ "${extension}" –¥–ª—è —Ñ–∞–π–ª–∞ "${file.name}"`);
      }

      // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
      if (file.size > MAX_FILE_SIZE * 0.8) {
        warnings.push(`–§–∞–π–ª "${file.name}" –¥–æ–≤–æ–ª—å–Ω–æ –±–æ–ª—å—à–æ–π (${formatFileSize(file.size)})`);
      }

      return { errors, warnings, isValid: errors.length === 0 };
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
    function handleFiles(files) {
      const fileArray = Array.from(files);
      let allValid = true;
      let allErrors = [];
      let allWarnings = [];

      // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      filesContainer.innerHTML = '';
      validationResults.innerHTML = '';

      fileArray.forEach((file, index) => {
        const validation = validateFile(file);

        if (!validation.isValid) {
          allValid = false;
          allErrors = allErrors.concat(validation.errors);
        }
        allWarnings = allWarnings.concat(validation.warnings);

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ñ–∞–π–ª–∞
        const fileElement = document.createElement('div');
        fileElement.className = `flex items-center space-x-3 p-3 rounded-lg ${validation.isValid ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`;

        const icon = getFileIcon(file.name);
        const statusColor = validation.isValid ? 'text-green-600' : 'text-red-600';

        fileElement.innerHTML = `
                    <div class="text-2xl">${icon}</div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">${file.name}</p>
                        <p class="text-xs text-gray-500">${formatFileSize(file.size)}</p>
                        ${validation.errors.length > 0 ? `<p class="text-xs text-red-600 mt-1">${validation.errors.join(', ')}</p>` : ''}
                    </div>
                    <div class="text-sm font-medium ${statusColor}">
                        ${validation.isValid ? '‚úÖ –ì–æ—Ç–æ–≤' : '‚ùå –û—à–∏–±–∫–∞'}
                    </div>
                `;

        filesContainer.appendChild(fileElement);
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
      fileList.style.display = 'block';

      // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
      if (allErrors.length > 0 || allWarnings.length > 0) {
        let resultsHTML = '';

        if (allErrors.length > 0) {
          resultsHTML += `
                        <div class="p-3 bg-red-50 border border-red-200 rounded-md mb-3">
                            <h5 class="text-sm font-medium text-red-800 mb-2">–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:</h5>
                            <ul class="text-sm text-red-700 space-y-1">
                                ${allErrors.map(error => `<li>‚Ä¢ ${error}</li>`).join('')}
                            </ul>
                        </div>
                    `;
        }

        if (allWarnings.length > 0) {
          resultsHTML += `
                        <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-md">
                            <h5 class="text-sm font-medium text-yellow-800 mb-2">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</h5>
                            <ul class="text-sm text-yellow-700 space-y-1">
                                ${allWarnings.map(warning => `<li>‚Ä¢ ${warning}</li>`).join('')}
                            </ul>
                        </div>
                    `;
        }

        validationResults.innerHTML = resultsHTML;
      }

      console.log('üìÅ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:', {
        total: fileArray.length,
        valid: fileArray.filter(f => validateFile(f).isValid).length,
        errors: allErrors.length,
        warnings: allWarnings.length
      });
    }

    // –ü–æ–ª—É—á–∏—Ç—å –∏–∫–æ–Ω–∫—É —Ñ–∞–π–ª–∞
    function getFileIcon(fileName) {
      const extension = fileName.split('.').pop().toLowerCase();
      const iconMap = {
        'pdf': 'üìÑ',
        'doc': 'üìù',
        'docx': 'üìù',
        'txt': 'üìÉ',
        'md': 'üìã',
        'rtf': 'üìÑ'
      };
      return iconMap[extension] || 'üìÑ';
    }

    // Event listeners
    uploadArea.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFiles(e.target.files);
      }
    });

    // Drag & Drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('border-blue-500', 'bg-blue-50');
    });

    uploadArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('border-blue-500', 'bg-blue-50');

      if (e.dataTransfer.files.length > 0) {
        handleFiles(e.dataTransfer.files);
      }
    });
  </script>
</body>

</html>